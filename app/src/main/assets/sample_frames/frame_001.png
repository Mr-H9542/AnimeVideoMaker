package com.example.animevideomaker;

import android.graphics.Bitmap;
import android.os.Environment;
import android.util.Log;

import java.io.File;
import java.io.FileOutputStream;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.List;
import java.util.Locale;

public class VideoEncoder {

    public static void save(List<VideoFrame> frames) {
        if (frames == null || frames.isEmpty()) return;

        String baseDir = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES).getAbsolutePath();
        String timestamp = new SimpleDateFormat("yyyyMMdd_HHmmss", Locale.US).format(new Date());
        File outputDir = new File(baseDir + "/AnimeVideoMaker/scene_" + timestamp);

        if (!outputDir.exists() && !outputDir.mkdirs()) {
            Log.e("VideoEncoder", "Failed to create output directory");
            return;
        }

        for (int i = 0; i < frames.size(); i++) {
            Bitmap bmp = frames.get(i).getBitmap();
            File outFile = new File(outputDir, String.format("frame_%03d.png", i));
            try (FileOutputStream out = new FileOutputStream(outFile)) {
                bmp.compress(Bitmap.CompressFormat.PNG, 100, out);
            } catch (Exception e) {
                Log.e("VideoEncoder", "Failed to save frame " + i, e);
            }
        }

        Log.i("VideoEncoder", "Saved " + frames.size() + " frames to " + outputDir.getAbsolutePath());
    }
}
